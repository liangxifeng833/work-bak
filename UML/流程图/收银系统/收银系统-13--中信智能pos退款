@startuml
title 收款-中信智能pos微信支付宝退款-流程图

|收银系统view|
start
:微信:smarty/refund_wechat.html;
:支付宝smarty/refund_alipay.html;
:加载智能pos ocx 控件;
|ocx|
:调用退款接口;
|收银系统view|
if(退款是否成功？)then(no)
    :提示交易失败;
    :重新发起交易;
    end
else(yes)
|ocx|
    :调用获取交易结果接口;
|收银系统view|
    :通过交易结果返回的json\n判断是否真正交易成功;
    if(返回json中交易是否成功？)then(no)
        :提示交易失败;
        :重新发起交易;
        end
    endif
endif
:调用收款模块接口修改数据库数据;
|收款模块|
    :修改微信wechat_annal数据\n修改支付宝表alipay_annal数据;
|收银系统view|

end
@enduml
